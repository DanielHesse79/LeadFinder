{% extends "base.html" %}

{% block title %}General Search - LeadFinder{% endblock %}

{% block meta_description %}Search and manage leads with AI-powered analysis and research capabilities{% endblock %}

{% block extra_css %}
<style>
    .status-dot {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }
    .status-green { background: #28a745; }
    .status-red { background: #dc3545; }
    .search-form {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
    }
    .stats-card {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
    }
    .action-buttons {
        background-color: #f8f9fa;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
    }
    .search-history {
        background-color: #e3f2fd;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
    }
    .leads-table {
        background: white;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        font-weight: 600;
    }
    .table td {
        vertical-align: middle;
        border-color: #dee2e6;
    }
    .btn-action {
        margin: 0.25rem;
    }
    .ollama-status {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }
    .lead-title {
        font-weight: 600;
        color: #495057;
        line-height: 1.2;
    }
    .lead-summary {
        font-size: 0.9rem;
        color: #6c757d;
        line-height: 1.3;
    }
    .lead-source {
        font-size: 0.8rem;
        color: #28a745;
        font-weight: 600;
    }
    .ai-status-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    .delete-btn {
        transition: all 0.2s ease;
    }
    .delete-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
    }
    .table-hover tbody tr:hover {
        background-color: rgba(102, 126, 234, 0.05);
    }
    .search-form .form-text {
        color: rgba(255, 255, 255, 0.8);
    }
    .search-form .form-control {
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem 1rem;
    }
    .search-form .form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);
    }
    .search-form .btn {
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    .search-form .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
    }
    .filter-section {
        background: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .filter-section .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.5rem;
    }
    .filter-section .form-control {
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
    }
    .filter-section .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    .pagination .page-link {
        border-radius: 0.5rem;
        margin: 0 0.25rem;
        border: none;
        color: #667eea;
        background: white;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .pagination .page-link:hover {
        background: #667eea;
        color: white;
        transform: translateY(-1px);
    }
    .pagination .page-item.active .page-link {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
    }
    .export-section {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
    }
    .export-section .btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        border-radius: 0.5rem;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        margin: 0.25rem;
    }
    .export-section .btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
        color: white;
    }
    .loading-spinner {
        display: none;
        text-align: center;
        padding: 2rem;
    }
    .loading-spinner.show {
        display: block;
    }
    .spinner-border {
        width: 3rem;
        height: 3rem;
    }
    .alert {
        border-radius: 0.5rem;
        border: none;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .modal-content {
        border-radius: 1rem;
        border: none;
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175);
    }
    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 1rem 1rem 0 0;
        border: none;
    }
    .modal-body {
        padding: 2rem;
    }
    .modal-footer {
        border: none;
        padding: 1.5rem 2rem;
    }
    .btn-close {
        filter: invert(1);
    }
    .form-check-input:checked {
        background-color: #667eea;
        border-color: #667eea;
    }
    .form-check-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    .badge {
        border-radius: 0.5rem;
        font-weight: 500;
    }
    .badge-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .badge-success {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    .badge-warning {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    .badge-info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    .tooltip {
        font-size: 0.875rem;
    }
    .tooltip-inner {
        background: #495057;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
    }
    .bs-tooltip-top .tooltip-arrow::before {
        border-top-color: #495057;
    }
    .bs-tooltip-bottom .tooltip-arrow::before {
        border-bottom-color: #495057;
    }
    .bs-tooltip-start .tooltip-arrow::before {
        border-left-color: #495057;
    }
    .bs-tooltip-end .tooltip-arrow::before {
        border-right-color: #495057;
    }
    @media (max-width: 768px) {
        .search-form {
            padding: 1.5rem;
        }
        .stats-card {
            margin-bottom: 1rem;
        }
        .action-buttons {
            padding: 1rem;
        }
        .table-responsive {
            font-size: 0.875rem;
        }
        .btn-action {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        .export-section .btn {
            display: block;
            margin: 0.5rem 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-header">
                <div class="container">
                    <h1 class="display-4 mb-3">
                        <i class="fas fa-search me-3"></i>Lead Discovery
                    </h1>
                    <p class="lead mb-0">Search and analyze leads with AI-powered insights</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ollama Status -->
    <div class="container">
        <div class="ollama-status">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="mb-1">
                        <i class="fas fa-robot me-2"></i>Ollama Status
                    </h5>
                    <p class="mb-0">AI Analysis Engine</p>
                </div>
                <div class="col-md-4 text-end">
                    <span class="status-dot status-green"></span>
                    <span class="fw-bold">Online</span>
                </div>
            </div>
        </div>

        <!-- Search Form -->
        <div class="search-form">
            <h3 class="mb-4">
                <i class="fas fa-search me-2"></i>Search for Leads
            </h3>
            <form id="search-form" method="POST" action="{{ url_for('search.search_ajax') }}">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="query" class="form-label">Search Query</label>
                            <input type="text" class="form-control" id="query" name="query" 
                                   placeholder="Enter your search query..." required>
                            <div class="form-text">Enter keywords, company names, or research topics</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="research_question" class="form-label">Research Question</label>
                            <input type="text" class="form-control" id="research_question" name="research_question" 
                                   placeholder="What specific information are you looking for?">
                            <div class="form-text">Optional: Specify what you want to learn</div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-8">
                        <div class="form-group">
                            <label class="form-label">Search Engines</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="engines" value="serp" id="serp" checked>
                                <label class="form-check-label" for="serp">Web Search</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="engines" value="pubmed" id="pubmed">
                                <label class="form-check-label" for="pubmed">PubMed</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="engines" value="semantic" id="semantic">
                                <label class="form-check-label" for="semantic">Semantic Scholar</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-light btn-lg w-100" id="search-btn">
                                <i class="fas fa-search me-2"></i>Search
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-users fa-2x mb-2"></i>
                    <div class="stat-number">{{ stats.total_leads|default(0) }}</div>
                    <small>Total Leads</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-search fa-2x mb-2"></i>
                    <div class="stat-number">{{ stats.total_searches|default(0) }}</div>
                    <small>Total Searches</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-robot fa-2x mb-2"></i>
                    <div class="stat-number">{{ stats.ai_analyses|default(0) }}</div>
                    <small>AI Analyses</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-chart-line fa-2x mb-2"></i>
                    <div class="stat-number">{{ stats.success_rate|default(0) }}%</div>
                    <small>Success Rate</small>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <h5 class="mb-3">
                <i class="fas fa-cogs me-2"></i>Quick Actions
            </h5>
            <div class="row">
                <div class="col-md-3">
                    <a href="{{ url_for('leads.export_to_excel') }}" class="btn btn-outline-primary w-100 mb-2">
                        <i class="fas fa-download me-2"></i>Export Leads
                    </a>
                </div>
                <!-- Commented out non-existent endpoints
                <div class="col-md-3">
                    <a href="{{ url_for('leads.bulk_actions') }}" class="btn btn-outline-success w-100 mb-2">
                        <i class="fas fa-tasks me-2"></i>Bulk Actions
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{{ url_for('leads.analytics') }}" class="btn btn-outline-info w-100 mb-2">
                        <i class="fas fa-chart-line me-2"></i>Analytics
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{{ url_for('leads.settings') }}" class="btn btn-outline-secondary w-100 mb-2">
                        <i class="fas fa-cog me-2"></i>Settings
                    </a>
                </div>
                -->
            </div>
        </div>

        <!-- Search History -->
        <div class="search-history">
            <h5 class="mb-3">
                <i class="fas fa-history me-2"></i>Recent Searches
            </h5>
            <div id="search-history-list">
                <!-- Search history will be loaded here -->
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-section">
            <h5 class="mb-3">
                <i class="fas fa-filter me-2"></i>Filters
            </h5>
            <div class="row">
                <div class="col-md-3">
                    <label for="source-filter" class="form-label">Source</label>
                    <select class="form-select" id="source-filter">
                        <option value="">All Sources</option>
                        <option value="web">Web Search</option>
                        <option value="pubmed">PubMed</option>
                        <option value="semantic">Semantic Scholar</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="date-filter" class="form-label">Date Range</label>
                    <select class="form-select" id="date-filter">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="status-filter" class="form-label">Status</label>
                    <select class="form-select" id="status-filter">
                        <option value="">All Status</option>
                        <option value="new">New</option>
                        <option value="analyzed">Analyzed</option>
                        <option value="contacted">Contacted</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="ai-filter" class="form-label">AI Analysis</label>
                    <select class="form-select" id="ai-filter">
                        <option value="">All</option>
                        <option value="analyzed">Analyzed</option>
                        <option value="pending">Pending</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Searching for leads...</p>
        </div>

        <!-- Results Table -->
        <div class="leads-table" id="results-container" style="display: none;">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="leads-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Source</th>
                            <th>Date</th>
                            <th>AI Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leads-tbody">
                        <!-- Results will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <nav aria-label="Leads pagination" id="pagination-container" style="display: none;">
            <ul class="pagination justify-content-center" id="pagination">
                <!-- Pagination will be generated here -->
            </ul>
        </nav>

        <!-- Export Section -->
        <div class="export-section">
            <h5 class="mb-3">
                <i class="fas fa-download me-2"></i>Export Options
            </h5>
            <div class="text-center">
                <button class="btn" onclick="exportLeads('csv')">
                    <i class="fas fa-file-csv me-2"></i>Export CSV
                </button>
                <button class="btn" onclick="exportLeads('excel')">
                    <i class="fas fa-file-excel me-2"></i>Export Excel
                </button>
                <button class="btn" onclick="exportLeads('pdf')">
                    <i class="fas fa-file-pdf me-2"></i>Export PDF
                </button>
                <button class="btn" onclick="exportLeads('json')">
                    <i class="fas fa-file-code me-2"></i>Export JSON
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Lead Details Modal -->
<div class="modal fade" id="leadModal" tabindex="-1" aria-labelledby="leadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leadModalLabel">Lead Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="leadModalBody">
                <!-- Lead details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="analyzeLead()">Analyze with AI</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Leads page specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const loadingSpinner = document.getElementById('loading-spinner');
    const resultsContainer = document.getElementById('results-container');
    const leadsTbody = document.getElementById('leads-tbody');
    const paginationContainer = document.getElementById('pagination-container');
    
    // Handle search form submission
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show loading spinner
        loadingSpinner.classList.add('show');
        resultsContainer.style.display = 'none';
        paginationContainer.style.display = 'none';
        
        // Get form data
        const formData = new FormData(searchForm);
        
        // Make AJAX request
        fetch(searchForm.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            // Hide loading spinner
            loadingSpinner.classList.remove('show');
            
            if (data.success) {
                displayResults(data.results);
                showNotification('Search completed successfully!', 'success');
            } else {
                showNotification('Search failed: ' + data.error, 'danger');
            }
        })
        .catch(error => {
            loadingSpinner.classList.remove('show');
            showNotification('Error: ' + error.message, 'danger');
        });
    });
    
    // Display search results
    function displayResults(results) {
        leadsTbody.innerHTML = '';
        
        results.forEach(lead => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <div class="lead-title">${sanitizeHTML(lead.title)}</div>
                    <div class="lead-summary">${sanitizeHTML(lead.summary)}</div>
                </td>
                <td>
                    <span class="lead-source">${sanitizeHTML(lead.source)}</span>
                </td>
                <td>${formatDate(lead.date)}</td>
                <td>
                    <span class="badge ai-status-badge ${lead.ai_status === 'analyzed' ? 'badge-success' : 'badge-warning'}">
                        ${lead.ai_status}
                    </span>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-primary btn-action" onclick="viewLead(${lead.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success btn-action" onclick="analyzeLead(${lead.id})">
                        <i class="fas fa-robot"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger btn-action delete-btn" onclick="deleteLead(${lead.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            leadsTbody.appendChild(row);
        });
        
        resultsContainer.style.display = 'block';
    }
    
    // View lead details
    window.viewLead = function(leadId) {
        fetch(`/api/leads/${leadId}`)
            .then(response => response.json())
            .then(data => {
                const modalBody = document.getElementById('leadModalBody');
                modalBody.innerHTML = `
                    <h6>Title</h6>
                    <p>${sanitizeHTML(data.title)}</p>
                    <h6>Summary</h6>
                    <p>${sanitizeHTML(data.summary)}</p>
                    <h6>Source</h6>
                    <p>${sanitizeHTML(data.source)}</p>
                    <h6>URL</h6>
                    <p><a href="${data.url}" target="_blank">${sanitizeHTML(data.url)}</a></p>
                    ${data.ai_analysis ? `<h6>AI Analysis</h6><p>${sanitizeHTML(data.ai_analysis)}</p>` : ''}
                `;
                
                const modal = new bootstrap.Modal(document.getElementById('leadModal'));
                modal.show();
            })
            .catch(error => {
                showNotification('Error loading lead details: ' + error.message, 'danger');
            });
    };
    
    // Analyze lead with AI
    window.analyzeLead = function(leadId) {
        showNotification('Analyzing lead with AI...', 'info');
        
        fetch(`/api/leads/${leadId}/analyze`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('AI analysis completed!', 'success');
                // Refresh the lead row to show updated status
                location.reload();
            } else {
                showNotification('AI analysis failed: ' + data.error, 'danger');
            }
        })
        .catch(error => {
            showNotification('Error: ' + error.message, 'danger');
        });
    };
    
    // Delete lead
    window.deleteLead = function(leadId) {
        if (confirm('Are you sure you want to delete this lead?')) {
            fetch(`/api/leads/${leadId}`, {
                method: 'DELETE',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Lead deleted successfully!', 'success');
                    // Remove the row from the table
                    const row = document.querySelector(`tr[data-lead-id="${leadId}"]`);
                    if (row) row.remove();
                } else {
                    showNotification('Failed to delete lead: ' + data.error, 'danger');
                }
            })
            .catch(error => {
                showNotification('Error: ' + error.message, 'danger');
            });
        }
    };
    
    // Export leads
    window.exportLeads = function(format) {
        showNotification(`Exporting leads as ${format.toUpperCase()}...`, 'info');
        
        const filters = {
            source: document.getElementById('source-filter').value,
            date: document.getElementById('date-filter').value,
            status: document.getElementById('status-filter').value,
            ai_status: document.getElementById('ai-filter').value
        };
        
        fetch('/api/leads/export', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({
                format: format,
                filters: filters
            })
        })
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `leads_export.${format}`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            showNotification('Export completed successfully!', 'success');
        })
        .catch(error => {
            showNotification('Export failed: ' + error.message, 'danger');
        });
    };
    
    // Load search history
    function loadSearchHistory() {
        fetch('/api/search/history')
            .then(response => response.json())
            .then(data => {
                const historyList = document.getElementById('search-history-list');
                historyList.innerHTML = '';
                
                data.history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'mb-2';
                    historyItem.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-search text-primary me-2"></i>
                                <strong>${sanitizeHTML(item.query)}</strong>
                                <small class="text-muted">- ${item.results_count} results</small>
                            </div>
                            <small class="text-muted">${formatDate(item.date)}</small>
                        </div>
                    `;
                    historyList.appendChild(historyItem);
                });
            })
            .catch(error => {
                console.error('Error loading search history:', error);
            });
    }
    
    // Initialize
    loadSearchHistory();
    
    // Apply filters
    document.querySelectorAll('#source-filter, #date-filter, #status-filter, #ai-filter').forEach(filter => {
        filter.addEventListener('change', function() {
            // Reload results with new filters
            searchForm.dispatchEvent(new Event('submit'));
        });
    });
});
</script>
{% endblock %} 
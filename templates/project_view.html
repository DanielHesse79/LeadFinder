{% extends "base.html" %}

{% block title %}{{ project.name }} - 4Front2Market Lead Workshop{% endblock %}

{% block extra_css %}
<style>
    .project-header {
        background: linear-gradient(135deg, var(--4front-dark-blue) 0%, var(--4front-mid-blue) 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    .analysis-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .relevancy-score {
        font-size: 1.2rem;
        font-weight: bold;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        display: inline-block;
    }
    .score-1 { background-color: #dc3545; color: white; }
    .score-2 { background-color: #fd7e14; color: white; }
    .score-3 { background-color: var(--4front-yellow); color: var(--4front-dark-blue); }
    .score-4 { background-color: #20c997; color: white; }
    .score-5 { background-color: #28a745; color: white; }
    .contact-info {
        background-color: var(--4front-light-yellow);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 0.5rem;
    }
    .edit-form {
        background-color: var(--4front-light-gray);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="container">
        <!-- Project Header -->
        <div class="project-header rounded">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-folder"></i> {{ project.name }}</h1>
                    <p class="mb-0">{{ project.description or 'No description provided' }}</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="{{ url_for('lead_workshop.lead_workshop_home') }}" class="btn btn-light me-2">
                        <i class="fas fa-arrow-left"></i> Back to Workshop
                    </a>
                    <a href="{{ url_for('lead_workshop.edit_report', project_id=project.id) }}" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Edit Report
                    </a>
                    <a href="{{ url_for('lead_workshop.export_pdf', project_id=project.id) }}" class="btn btn-success ms-2">
                        <i class="fas fa-file-pdf"></i> Export PDF Report
                    </a>
                    <a href="{{ url_for('lead_workshop.export_markdown', project_id=project.id) }}" class="btn btn-warning ms-2">
                        <i class="fas fa-file-alt"></i> Export Workshop Markdown
                    </a>
                </div>
            </div>
        </div>

        <!-- Project Stats -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">{{ project.leads|length }}</h5>
                        <p class="card-text">Total Leads</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">{{ project.leads|selectattr('status', 'equalto', 'contacted')|list|length }}</h5>
                        <p class="card-text">Contacted</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">{{ project.leads|selectattr('status', 'equalto', 'qualified')|list|length }}</h5>
                        <p class="card-text">Qualified</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">{{ project.leads|selectattr('status', 'equalto', 'converted')|list|length }}</h5>
                        <p class="card-text">Converted</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leads Analysis -->
        <div class="row">
            <div class="col-12">
                <h3><i class="fas fa-chart-line"></i> Leads Analysis</h3>
                
                {% for lead in project.leads %}
                <div class="analysis-card">
                    <div class="row">
                        <div class="col-md-8">
                            <h5>{{ lead.name }}</h5>
                            <p class="text-muted">{{ lead.company or 'No company specified' }}</p>
                            <p>{{ lead.description or 'No description provided' }}</p>
                            
                            <!-- Contact Information -->
                            {% if lead.email or lead.phone or lead.linkedin %}
                            <div class="contact-info">
                                <h6><i class="fas fa-address-book"></i> Contact Information</h6>
                                {% if lead.email %}
                                <p class="mb-1"><i class="fas fa-envelope"></i> {{ lead.email }}</p>
                                {% endif %}
                                {% if lead.phone %}
                                <p class="mb-1"><i class="fas fa-phone"></i> {{ lead.phone }}</p>
                                {% endif %}
                                {% if lead.linkedin %}
                                <p class="mb-1"><i class="fab fa-linkedin"></i> <a href="{{ lead.linkedin }}" target="_blank">LinkedIn Profile</a></p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <div class="text-end">
                                <span class="relevancy-score score-{{ lead.relevancy_score }}">
                                    Score: {{ lead.relevancy_score }}/5
                                </span>
                                <br><br>
                                <span class="badge bg-{{ 'success' if lead.status == 'converted' else 'warning' if lead.status == 'qualified' else 'info' if lead.status == 'contacted' else 'secondary' }}">
                                    {{ lead.status|title }}
                                </span>
                                <br><br>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-primary" onclick="editLead({{ lead.id }})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline-success" onclick="updateStatus({{ lead.id }}, 'qualified')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="deleteLead({{ lead.id }})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function editLead(leadId) {
        // Implement lead editing functionality
        console.log('Edit lead:', leadId);
    }
    
    function updateStatus(leadId, status) {
        fetch('/lead-workshop/update-lead-status', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                lead_id: leadId,
                status: status
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error updating status: ' + data.error);
            }
        })
        .catch(error => {
            alert('Error updating status: ' + error);
        });
    }
    
    function deleteLead(leadId) {
        if (confirm('Are you sure you want to delete this lead?')) {
            fetch('/lead-workshop/delete-lead', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    lead_id: leadId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error deleting lead: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error deleting lead: ' + error);
            });
        }
    }
</script>
{% endblock %} 